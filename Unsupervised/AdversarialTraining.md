# Adversarial Training, 적대적 학습

## 1. What is Adversarial Training?
- 머신러닝이나 딥러닝의 경우 주로 라벨링된 데이터를 가지고 학습을 진행한다.
- 그리고 학습 진행 후 테스트 데이터를 통해 모델이 잘 학습되었는지 평가한다.
- 그러나 기존 데이터에 약간의 노이즈를 주어 "adversarial example"을 생성하여 평가하면
  기존 학습된 모델은 이에 대해 제대로 대처하지 못하는 경우가 많다.
- 따라서 이런 적대적 공격(노이즈)에 대응하기 위한 학습이 Adversarial Training 이다.
- 적대적 학습에는 공격과 방어가 있다.
  - 공격은 말 그대로 데이터에 오염을 주거나 라벨링에 혼동을 주는 행위를 말한다.
  - 방어는 공격으로부터 모델이 대응하는 것을 말한다.

### 1-1. 비지도 학습에서 적대적 접근 방식
- 비지도 학습에서 적대적 접근 방식은 주로 GAN 과 같은 구조를 활용하여, 레이블이 없는 데이터에서도
  유의미한 특징을 학습하는 방법이다.
- 비지도 학습에서 이 적대적 접근 방식의 장점은 레이블이 없는 데이터에서도 데이터의 분포를 학습할 수 있다는 것이다.
- GAN 을 사용하면 데이터를 명시적으로 분류하거나 레이블링하지 않고도 데이터의 숨겨진 특징을 학습할 수 있다.
- 예를 들어 이미지 생성, 데이터 증강 그리고 이상 탐지 등에서 비지도 학습 방식의 GAN이 활용될 수 있다.
- GAN의 변형 모델인 Adversarial Autoencoders와 같은 방식도 비지도 학습에서 자주 사용된다.

### 1-2. 생산적 적대 신경망 (GAN, Generative Adversarial Network)
- GAN 은 두 개의 신경망, 즉 생성자(Generator)와 판별자(Discriminator)가 서로 경쟁하는 방식으로 작동한다.
- 이 적대적 관계를 통해 모델은 레이블이 없는 데이터에서 패턴을 학습하게 된다.

#### GAN 기본 원리
- 생성자: 랜덤한 노이즈 백터를 입력으로 받아 가짜 데이터를 생성한다.
  이 데이터는 실제 데이터를 흉내 내는 방식으로 생성된다.
- 판별자: 생성자가 만든 가짜 데이터와 실제 데이터를 구분하려고 시도한다.
  즉 이 신경망은 입력 데이터가 진짜인지 가짜인지를 판별하는 역할을 한다.
- 두 네트워크는 서로 적대적으로 학습한다. 생성자는 판별자를 속이기 위해 점점 더 진짜 같은 데이터를 생성하려 한다.
- 반대로 판별자는 그 데이터를 구분하기 위해 더 정교하게 학습한다.
- 이 과정이 반복되면서 생성자는 점점 더 진짜와 유사한 데이터를 만들 수 있게 되고,
  판별자는 진짜와 가짜를 구분하는 능력이 향상된다.

### 1-3. AEE, Adversarial Autoencoder
- Adversarial Autoencoder 는 GAN 과 Autoencoder 의 아이디어를 결합한 모델이다.
- AEE 는 주로 비지도학습, 반지도 학습 또는 지도학습에서 데이터의 잠재 공간(latent space)을 제어하고,
  특정 분포를 따르도록 학습시키기 위해 사용된다.
- 이 모델은 데이터의 잠재 표현(latent representation)을 특정한 분포로 강제하는 데 GAN 의 적다적 학습 방식을 사용한다.

> !참고 - 잠재 공간과 잠재 표현

    잠재 공간과 잠재 표현은 기계 학습에서 주로 사용되는 개념으로, 데이터의 압축된 표현을 의미한다.
    잠재 공간(latent space)
    **잠재 공간은 고차원의 원본 데이터를 압축하여 표현된 저차원 공간이다.**  
    이 공간은 원본 데이터의 중요한 특징들을 요약하여 나타내며, 데이터를 더 간결하고 의미 있는 방식으로 표현 한다.
    - 고차원 데이터의 저차원적 표현
      예를 들어, 이미지 데이터는 수천, 수만 개의 픽셀로 이루어져 있지만, 이 이미지의 본질적인 정보는 몇 개의
      중요한 특징으로 요약할 수 있다. 잠재 공간은 이런 본질적인 특징들을 표현하는 저차원 공간을 말한다.
    - 추상적이고 압축된 표현
      잠재 공간은 원본 데이터의 구체적인 정보(예: 이미지의 각 픽셀 값)가 아닌, 그 데이터의 중요한 패턴이나 특징을  
      추상적으로 나타낸다. 따라서 원본 데이터를 압축하고 요약한 공간이라 볼 수 있다.
    잠재 표현(latent representation)
    잠재 표현은 **데이터가 잠재 공간에서 어떻게 표현되는지를 의미한다.** 즉, 원본 데이터를 인코더가 잠재 공간으로
    변환한 결과가 잠재 표현이다. 이는 원본 데이터의 압축된 벡터 형태로, 데이터를 더 간결하고 의미 있게 나타내는  
    방식이다. 예를 들어, 이미지가 인코더를 통해 잠재 공간으로 변환되면, 그 결과로 얻은 잠재 벡터가 잠재 표현이다.

#### AAE 의 구성요소
1. 오토인코더 구조
  - 오토 인코더는 입력 데이터를 압축하고 복원하는 데 그 목적이 있다. 인코더와 디코더는 각각 뉴럴 네트워크로 구성되며,
    인코더는 고차원 데이터를 저차원의 잠재 공간으로 매핑하고, 디코더는 이 잠재 표현을 다시 원래 데이터로 복원한다.
    - 인코더: 입력 데이터를 잠재 공간으로 변환합니다.
    - 디코더: 잼재 공간에서 다시 원래 데이터로 복원하는 역할을 합니다.
2. 잠재 공간에서의 적대적 학습
  - AAE 의 핵심은 인코더가 데이터를 잠재 공간으로 매핑할 때, 그 잠재 공간이 특정한 **사전 분포(prior distribution)**을
    따르도록 학습된다는 것이다.
  - 이를 위해 적대적 신경망 기법이 사용된다. GAN 처럼 두 신경망이 상호 경쟁하는 구조이다.
    - 생성자 역할을 인코더가 수행하고, 잠재 벡터를 생성한다.
    - 판별자는 인코더에서 생성한 잠재 벡터와 사전에 정의된 분포에서 샘플링된 벡터를 구분하는 역할을 한다.
3. GAN 과의 결합
  - GAN 과 유사하게 판별자는 인코더에서 생성된 잠재 벡터가 사전에 정의된 분포에서 온 것인지 아닌지를 구분하려고 시도한다.
  - 인코더는 판별자를 속이기 위해 잠재 벡터가 그 분포를 따르도록 학습한다.
  - 이 과정에서 인코더는 잠재 표현을 사전 분포와 일치하도록 학습하고, 이로 인해 잠재 공간은 특정 분포를 따르게 된다.

#### AAE 의 학습 과정
1. 재구성 손실을 최소화하는 단계
  - 오토 인코더처럼 인코더는 입력 데이터를 잠재 공간에 매핑하고, 디코더는 이를 다시 복원한다.
  - 이때 입력 데이터와 복원된 데이터 간의 차이를 최소화하는 재구성 손실(reconstruction loss)을 최소화 하는 방식으로 학습된다.
2. 잠재공간에서의 적대적 학습 단계
  - 인코더가 생성한 잠재 벡터가 사전 분포와 일치하도록 하기 위해, 판별자는 인코더의 잠재 벡터와 사전 분포에서 샘플링된 벡터를
    구분하는 방식으로 학습된다.
 
#### AAE 의 장점
- 비지도학습
  - AAE 는 레이블이 없는 데이터를 학습하는 비지도 학습에서 매우 유용하다.
  - 잠재 공간을 사전 분포로 강제하기 때문에, 데이터의 구조를 더 잘 이해할 수 있다.
- 반지도 학습
  - 데이터의 일부에만 레이블이 있을 때도 AAE 는 효과적이다.
  - 레이블이 없는 데이터는 잠재 공간을 제어하는데 사용되고, 레이블이 있는 데이터는 분류 작업에 활용된다.
- 생성 모델
  - AAE 는 상성 모델로서도 매우 유용하다. 잠재 공간이 사전 분포를 따르도록 학습되기 때문에,
    잠재 공간에서의 임의의 벡터를 샘플링하여 새로운 데이터를 생성할 수 있다.
  - 이는 GAN 과 유사하지만, AEE 는 오토인코더의 구조를 사용하여 잠재 공간을 명시적으로 제어한다는 차이가 있다.
            
#### AAE의 응용
- 이상 탐지
 - AAE 는 정상적인 데이터의 분포를 학습한 후, 잠재 공간에서 벗어난 이상 데이터를 탐지하는데 사용할 수 있다.
 - 예를 들어, 제조업에서 제품의 결함을 탐지하거나, 금융 분야에서 비정상적인 거래 데이터를 탐지하는데 활용된다.
 - AAE 는 정상 데이터의 특정 분포를 학습하므로, 그 분포에서 벗어난 데이터는 이상으로 간주할 수 있다. 

<br>
<hr>

## 항공 엔진의 유효 수명 예측에서 비지도 학습의 적대적 방식 사용 사례
- 항공 엔진의 유효 수명 예측에서 비지도 학습의 적대적 방식을 사용하는 방법은 GAN 또는 AAE 와 같은 모델을 활용하여
  레이블이 없는 엔진 데이터로부터 엔진 상태를 추론하고, 이상 탐지 또는 수명 예측을 수행하는 방법이다.
- 이와 같은 비지도 학습 방식은 특히 정상 상태의 데이터만 존재하거나, 고장 데이터가 부족한 상황에서 유용하다.

### 문제 정의
- 항공 엔진의 유효 수명 예측은 엔진 상태 모니터링을 통해 남은 수명(RUL)을 추정하는 문제이다.
- 이때, 비지도 학습 방식의 적대적 기법은 다음과 같은 상황에서 도움이 될 수 있다.
  - 정상 상태의 데이터만 존재: 고장 데이터가 거의 없을 때, 정상 데이터를 학습하여 잠재 공간에서
    정상 패턴을 학습하고, 잠재 공간에서 벗엇나는 데이터를 이상으로 간주할 수 있다.
  - 다양한 엔진의 상태 변화: 엔진의 센서 데이터는 시계열로 수집되며, 다양한 상태에서의 데이터를 포함한다.
    비지도 학습을 통해 이러한 다양한 상태의 특징을 자동으로 추출하고, 엔진의 전체적인 수명 추정에 활용할 수 있다.

### 적대적 방식의 접근법
#### AAE 기반 방법
- 데이터 전처리
  - 엔진 센서 데이터를 정규화하고, 시계열 데이터를 일정한 길이의 구간으로 나눈다.
  - 각 구간은 엔진의 특정 상태를 나타내며, 이 상태를 잠재 공간으로 매핑하는 것이 목표다.
- 오토인코더 모델  
  - AAE 는 오토인코더 구조를 기반으로 한다. 인코더는 엔진의 시계열 데이터를 잠재 공간으로 변환한다.
  - 디코더는 이를 다시 원래 데이터로 복원하고, 이 과정에서 재구성 손실을 최소화 하는 방식으로 학습된다.
- 잠재 공간에서의 적대적 학습  
  - 잠재 공간은 사전에 정의된 분포를 따르도록 학습된다. 이를 위해 적대적 네트워크가 사용된다.
  - 인코더가 생성한 잠재 벡터와 사전 분포로부터 샘플링된 벡터를 구분하는 판별자가 추가된다.
  - 정상 패턴 학습: 인코더는 정상 데이터를 잠재 공간으로 변환하고, 이 잠재 벡터가 사전 분포와 일치하도록 학습된다.
    정상 데이터가 사전 분포를 따르도록 강제되면, 잠재 공간에서 벗어난 벡터들은 이상 데이터로 간주될 수 있다.
- 이상 탐지 및 수명 예측
  - 새로운 엔진 데이터가 주어지면, 인코더는 이를 잠재 공간으로 변환한다.
  - 이때, 잠재 공간에서 사전 분포와의 차이를 측정하여 엔진의 상태를 평가한다.
  - 잠재 공간에서 벗어난 벡터는 엔진이 정상 상태를 벗어났음을 의미하며,
    이를 바탕으로 엔진의 남은 수명이나 이상 상태를 예측할 수 있다.

#### GAN 기반 방법
- 데이터 전처리
  - 마찬가지로 엔진의 센서 데이터를 시계열로 나누고 정규화한다. 각 시점의 데이터를 잠재 공간으로 매핑하는 것이 목표이다.
- GAN 구조
  - 생성자: 랜덤한 노이즈를 입력으로 받아, 이를 기반으로 엔진의 정상 상태 시계열 데이터를 생성한다.
  - 판별자: 생성된 데이터와 실제 엔진 데이터를 구분하는 역할을 한다.
- 적대적 학습
  - 생성자는 판별자를 속이기 위해 점점 더 정상 데이터를 잘 모방하는 데이터를 생성하고,
    판별자는 이를 구분하려고 학습한다.
  - 위 과정에서 생성자는 정상 데이터의 패턴을 학습하게 되어,
    실제 엔진의 정상 상태와 유사한 데이터를 생성하는 능력이 향상된다. 
- 이상탐지 및 수명 예측
  - 훈련이 완료되면, 판별자는 정상 상태와 비정상 상태를 구분할 수 있게된다.
  - 새로운 엔진 데이터가 주어졌을 때, 판별자가 이 데이터를 정상 데이터와 비교하여 정상인지 아닌지를 판단할 수 있다.
  - 판별자가 고장 징후를 보이는 데이터를 비정상으로 분류함으로써, 엔진의 남은 수명을 예측하거나 이상 상태를 감지할 수 있다.

### 적대적 비지도 학습의 장점
- 정상 데이터만으로 학습 가능  
  항공 엔진의 고장 데이터는 구하거 어려운 경우가 많다. 적대적 비지도 학습 방식은 정상 상태의 데이터만으로도
  효율적으로학습할 수 있어, 고장 데이터가 부족한 상황에서 매우 유용하다.
- 잠재 공간에서의 데이터 구조 파악
  AAE 나 GAN 을 통해 잠재 공간을 학습하면, 엔진 상태의 복잡한 패턴을 잠재 공간에서 추상화 할 수 있다.
  이를 통해 엔진의 여러 상태를 명확하게 구분할 수 있으며, 비정상적인 상태를 쉽게 탐지할 수 있다.
- 이상 탐지 및 수명 예측
  비지도 학습 방식은 레이블이 없는 데이터에서도 패턴을 탐지하고, 잠재 공간에서 벗어난 데이터를 이상으로 인식하여
  수명 예측에 활용할 수 있다. 이를 통해 엔진의 고장 가능성을 사전에 감지하고, 유지 보수 비용을 절감할 수 있다.

### 결론
- 비지도 학습의 적대적 방식을 사용한 항공 엔진 유효 수명 예측은 정상 상태의 데이터만으로 학습한 후,
  잠재 공간에서 벗어난 데이터를 이상 상태로 감지함으로써 고장 가능성을 예측하는 방법이다.
- 이는 레이블이 부족한 상황에서 유용하며, 정상 데이터에서 학습된 패턴을 통해 수명 예측과 이상 탐지를
  효과적으로 수행할 수 있다.
- 이러한 방법은 예측 유지보수 시스템 구축에 기여하여 비용 절감과 안전성 향승을 동시에 달성할 수 있게 한다.
